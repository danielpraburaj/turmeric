<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turmeric Adulteration Detector</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
        }
        #image-preview {
            max-width: 300px;
            margin-top: 20px;
        }
        #loading {
            display: none;
            font-size: 18px;
            color: red;
        }
        #result {
            font-size: 22px;
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Turmeric Adulteration Detector</h1>
    <input type="file" id="imageUpload" accept="image/*">
    <br><br>
    <img id="image-preview" style="display:none;">
    <br>
    <button id="submitButton">Submit</button>
    <p id="loading">Loading Model...</p>
    <p id="result"></p>

    <script>
        let model;

        async function loadModel() {
            try {
                document.getElementById("loading").style.display = "block";
                model = await tf.loadLayersModel("model/model.json");
                document.getElementById("loading").style.display = "none";
            } catch (error) {
                alert("Failed to load model. Check console for errors.");
                console.error(error);
            }
        }

        document.getElementById("submitButton").addEventListener("click", async function() {
            if (!model) {
                alert("Model is still loading. Please wait.");
                return;
            }

            let fileInput = document.getElementById("imageUpload");
            if (fileInput.files.length === 0) {
                alert("Please upload an image first.");
                return;
            }

            let file = fileInput.files[0];
            let img = document.getElementById("image-preview");
            img.src = URL.createObjectURL(file);
            img.style.display = "block";

            await new Promise(resolve => img.onload = resolve);

            let tensor = tf.browser.fromPixels(img)
                .resizeNearestNeighbor([224, 224])
                .toFloat()
                .expandDims();

            let prediction = await model.predict(tensor).data();
            document.getElementById("result").innerText = prediction[0] > 0.5 ? "ðŸš¨ Lead Adulterated" : "âœ… Pure Turmeric";
        });

        loadModel();
    </script>
</body>
</html>
